{% extends "admin/base_site.html" %}
{% load i18n static admin_urls %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    .dashboard-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      flex: 1;
      min-width: 250px;
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 20px;
      text-align: center;
    }

    .stat-card .icon {
      font-size: 3em;
      margin-bottom: 10px;
    }

    .stat-card .number {
      font-size: 2em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-card .title {
      color: #666;
      font-size: 1.1em;
    }

    .stat-card.blue {
      border-top: 4px solid #0d6efd;
    }

    .stat-card.green {
      border-top: 4px solid #198754;
    }

    .stat-card.orange {
      border-top: 4px solid #fd7e14;
    }

    .stat-card.purple {
      border-top: 4px solid #6f42c1;
    }

    .card {
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .card-header {
      padding: 15px 20px;
      border-bottom: 1px solid #eee;
      font-weight: bold;
    }

    .card-body {
      padding: 20px;
    }

    .category-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .category-item:last-child {
      border-bottom: none;
    }

    .latest-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .latest-list li {
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }

    .latest-list li:last-child {
      border-bottom: none;
    }

    .latest-list .meta {
      color: #666;
      font-size: 0.9em;
      margin-top: 3px;
    }

    .dashboard-sections {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 992px) {
      .dashboard-sections {
        grid-template-columns: 1fr;
      }
    }
  </style>
{% endblock %}

{% block content %}
<div id="content-main">
  <h1>{% trans "Панель адміністратора" %}</h1>

  <div class="dashboard-stats">
    <div class="stat-card blue">
      <div class="icon">
        <i class="fas fa-users"></i>
      </div>
      <div class="number">{{ total_users }}</div>
      <div class="title">Користувачів</div>
    </div>

    <div class="stat-card green">
      <div class="icon">
        <i class="fas fa-hands-helping"></i>
      </div>
      <div class="number">{{ volunteers }}</div>
      <div class="title">Волонтерів</div>
    </div>

    <div class="stat-card orange">
      <div class="icon">
        <i class="fas fa-user-friends"></i>
      </div>
      <div class="number">{{ vulnerable }}</div>
      <div class="title">Вразливих людей</div>
    </div>

    <div class="stat-card purple">
      <div class="icon">
        <i class="fas fa-tasks"></i>
      </div>
      <div class="number">{{ total_tasks }}</div>
      <div class="title">Завдань</div>
    </div>
  </div>

  <div class="dashboard-sections">
    <div class="dashboard-column">
      <div class="card">
        <div class="card-header">
          Завдання за статусом
        </div>
        <div class="card-body">
          <div class="category-item">
            <span>Активні завдання</span>
            <span>{{ active_tasks }}</span>
          </div>
          <div class="category-item">
            <span>Завершені завдання</span>
            <span>{{ completed_tasks }}</span>
          </div>
          <div class="category-item">
            <span>Усього завдань</span>
            <span>{{ total_tasks }}</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          Завдання за категоріями
        </div>
        <div class="card-body">
          {% for category in categories %}
          <div class="category-item">
            <span>{{ category.name }}</span>
            <span>{{ category.tasks_count }}</span>
          </div>
          {% empty %}
          <p class="empty-data">Немає категорій для відображення.</p>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="dashboard-column">
      <div class="card">
        <div class="card-header">
          Останні завдання
        </div>
        <div class="card-body">
          <ul class="latest-list">
            {% for task in latest_tasks %}
            <li>
              <a href="{% url 'admin:tasks_task_change' task.id %}">{{ task.title }}</a>
              <div class="meta">
                {{ task.get_status_display }} | {{ task.created_at|date:"d.m.Y H:i" }}
              </div>
            </li>
            {% empty %}
            <p class="empty-data">Немає завдань для відображення.</p>
            {% endfor %}
          </ul>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          Останні користувачі
        </div>
        <div class="card-body">
          <ul class="latest-list">
            {% for user in latest_users %}
            <li>
              <a href="{% url 'admin:users_user_change' user.id %}">{{ user.username }}</a>
              <div class="meta">
                {{ user.get_user_type_display }} | {{ user.date_joined|date:"d.m.Y H:i" }}
              </div>
            </li>
            {% empty %}
            <p class="empty-data">Немає користувачів для відображення.</p>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}